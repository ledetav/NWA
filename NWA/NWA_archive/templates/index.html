{% extends "base.html" %}
{% load static %}

{% block title %}Главная страница{% endblock %}

{% block page_content %}
<div class="index-page">
    <div class="index-page__grid">
        <section class="index-page__section index-page__section--upcoming-birthdays">
            <h2 class="index-page__section-title">Ближайшие именинники</h2>
            <div class="upcoming-birthdays__list">
                <!-- Пример именинника -->
                <div class="upcoming-birthdays__item">
                    <div class="upcoming-birthdays__date">15 мая</div>
                    <div class="upcoming-birthdays__avatar">
                        <i class="fa-solid fa-cat"></i>
                    </div>
                    <div class="upcoming-birthdays__name">Лапоух</div>
                </div>
                <div class="upcoming-birthdays__item">
                    <div class="upcoming-birthdays__date">25 мая</div>
                    <div class="upcoming-birthdays__avatar"><i class="fa-solid fa-cat"></i></div>
                    <div class="upcoming-birthdays__name">Бабуба</div>
                </div>
                <div class="upcoming-birthdays__item">
                    <div class="upcoming-birthdays__date">5 июня</div>
                    <div class="upcoming-birthdays__avatar"><i class="fa-solid fa-cat"></i></div>
                    <div class="upcoming-birthdays__name">Пощада</div>
                </div>
                 <div class="upcoming-birthdays__item">
                    <div class="upcoming-birthdays__date">10 июня</div>
                    <div class="upcoming-birthdays__avatar"><i class="fa-solid fa-cat"></i></div>
                    <div class="upcoming-birthdays__name">Нервотрепка</div>
                </div>
            </div>
        </section>

        <section class="index-page__section index-page__section--statistics">
            <h2 class="index-page__section-title">Было создано</h2>
            <div class="statistics-details">
                <div class="statistics-details__total-blogs">{{ blog_count }}</div>
                <div class="statistics-details__total-blogs-label">блогов</div>
                <div class="statistics-details__breakdown-title">в них:</div>
                <div class="statistics-details__breakdown-item"><span>{{ art_count }}</span> рисунков</div>
                <div class="statistics-details__breakdown-item"><span>{{ text_count }}</span> слов</div>
                <div class="statistics-details__breakdown-item"><span>{{ code_count }}</span> строк кода</div>
            </div>
        </section>

        <section class="index-page__section index-page__section--calendar">
            <h2 class="index-page__section-title">Календарь</h2>
            <div class="calendar">
                <div class="calendar__header">
                    <button id="Btn-back-calendar" title="Предыдущий месяц"><</button>
                    <h3 id="monthYearDisplayCalendar">Месяц Год</h3>
                    <button id="Btn-next-calendar" title="Следующий месяц">></button>
                </div>
                <div class="calendar__weekdays">
                    <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>
                </div>
                <div class="calendar__days">
                </div>
            </div>
        </section>

        <section class="index-page__section index-page__section--moderators">
            <h2 class="index-page__section-title">Ответственные</h2>
            <div class="moderators-list">
                <div class="moderator-item">
                    <div class="moderator-item__avatar">
                        <i class="fa-solid fa-user-secret"></i>
                    </div>
                    <div class="moderator-item__name">{{ name }}</div>
                    <div class="moderator-item__role">{{ position }}</div>
                    <div class="moderator-item__links">
                        <a href="[ссылка_вар]">Вар</a>
                        <a href="[ссылка_вк]">ВК</a>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
{% endblock page_content %}

{% block scripts_block %}
    {{ block.super }}
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const monthYearDisplayCalendar = document.getElementById('monthYearDisplayCalendar');
        const calendarDaysElement = document.querySelector('.index-page__section--calendar .calendar__days'); // Уточненный селектор
        const prevCalendarBtn = document.getElementById('Btn-back-calendar');
        const nextCalendarBtn = document.getElementById('Btn-next-calendar');

        if (!monthYearDisplayCalendar || !calendarDaysElement || !prevCalendarBtn || !nextCalendarBtn) {
            console.warn('Один или несколько элементов календаря не найдены. Календарь не будет инициализирован.');
        } else {
            let calendarCurrentDate = new Date();
            
            const birthdaysData = {
                [new Date().getFullYear()]: { // Текущий год
                    [new Date().getMonth() + 1]: [2, 15, 23] // Дни рождения в текущем месяце (2, 15, 23 число)
                },
            };

            function renderOldCalendar() {
                const year = calendarCurrentDate.getFullYear();
                const month = calendarCurrentDate.getMonth(); // 0-11

                monthYearDisplayCalendar.textContent = `${calendarCurrentDate.toLocaleString('ru-RU', { month: 'long' })} ${year}`;
                calendarDaysElement.innerHTML = '';

                const firstDayOfMonth = new Date(year, month, 1);
                const lastDayOfMonth = new Date(year, month + 1, 0);
                
                const firstDayOfWeek = (firstDayOfMonth.getDay() + 6) % 7; // 0 (Пн) - 6 (Вс)
                const totalDaysInMonth = lastDayOfMonth.getDate();

                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.classList.add('empty');
                    calendarDaysElement.appendChild(emptyCell);
                }

                const today = new Date();
                for (let i = 1; i <= totalDaysInMonth; i++) {
                    const dayCell = document.createElement('div');
                    dayCell.textContent = i;
                    dayCell.dataset.day = i;
                    dayCell.dataset.month = month + 1;
                    dayCell.dataset.year = year;

                    if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayCell.classList.add('today');
                    }
                    if (birthdaysData[year] && birthdaysData[year][month + 1] && birthdaysData[year][month + 1].includes(i)) {
                        dayCell.classList.add('has-birthday');
                    }
                    calendarDaysElement.appendChild(dayCell);
                }
            }

            prevCalendarBtn.addEventListener('click', () => {
                calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() - 1);
                renderOldCalendar();
            });

            nextCalendarBtn.addEventListener('click', () => {
                calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() + 1);
                renderOldCalendar();
            });
            
            renderOldCalendar();
        }
    });
    </script>
{% endblock scripts_block %}