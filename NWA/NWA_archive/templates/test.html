{% extends "base.html" %}
{% load static %}

{% block title %}ТЕСТ??{% endblock %}

{% block page_content %}
    <div class="content-container" style="margin-bottom: 20px; padding: 10px;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <p style="flex-grow: 1; margin: 0;">Этот проект спонсирован господином Тартальей на здоровые нервы. Поблагодарим Предвестника Её Величества за службу!</p>
            <button class="neumorphic-button" id="openNeumorphicModalBtn" title="Показать благодарность">
                <img src="https://s3.getstickerpack.com/storage/uploads/sticker-pack/genshin-impact-tartaglia/sticker_2.png?a3d01a4a5c5f97a1d0e72b110c5cfa78"
                     alt="Открыть модальное окно" style="max-width: 200px; vertical-align: middle; display: block;">
            </button>
        </div>
    </div>

    <div class="content-container" style="margin-bottom: 20px; padding: 10px;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <p style="flex-grow: 1; margin: 0;">Безграничная щедрость господина Тартальи не знает границ!</p>
            <img src="https://s3.getstickerpack.com/storage/uploads/sticker-pack/genshin-impact-tartaglia/sticker_2.png?a3d01a4a5c5f97a1d0e72b110c5cfa78"
                alt="Тарталья" style="max-width: 200px;">
        </div>
    </div>

    <div class="content-container" style="padding: 10px;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <p style="flex-grow: 1; margin: 0;">Ещё раз спасибо за всё, Предвестник!</p>
            <img src="https://s3.getstickerpack.com/storage/uploads/sticker-pack/genshin-impact-tartaglia/sticker_2.png?a3d01a4a5c5f97a1d0e72b110c5cfa78"
                alt="Тарталья" style="max-width: 200px;">
        </div>
    </div>
{% endblock page_content %}

{% block modal_block %}
<div id="neumorphicModal" class="modal-overlay" style="display: none;"> <!-- Изначально скрыто, JS управляет видимостью -->
    <div class="modal-content neumorphic-modal-window">
        <span class="modal-close-button" title="Закрыть">×</span>
        <h3>Неоморфическое модальное окно</h3>
        <p>Они мне надоели :(</p>
        <img src="https://s3.getstickerpack.com/storage/uploads/sticker-pack/genshin-impact-tartaglia/sticker_5.png?a3d01a4a5c5f97a1d0e72b110c5cfa78" alt="Тарталья недоволен" style="max-width: 300px; border-radius: 10px; margin-top:15px; display: block;">
        <div style="text-align: right; margin-top: 20px;">
            <button class="neumorphic-button modal-action-button">ОК</button>
            <button class="neumorphic-button modal-close-button-alt">Помучить еще..</button>
        </div>
    </div>
</div>
{% endblock modal_block %}

{% block scripts_block %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const modal = document.getElementById('neumorphicModal');
        const openModalBtn = document.getElementById('openNeumorphicModalBtn');
        
        // Ищем кнопки закрытия только после того, как убедились, что модальное окно существует
        const closeButtons = modal ? modal.querySelectorAll('.modal-close-button, .modal-close-button-alt') : [];
        const modalOkButton = modal ? modal.querySelector('.modal-action-button') : null;

        function openModal() {
            if (modal) {
                modal.style.display = 'flex'; // Показать оверлей
                document.body.style.overflow = 'hidden'; // Запретить скролл основной страницы
                setTimeout(() => {
                    modal.classList.add('open'); // Запустить анимацию появления модального окна
                }, 10); // Небольшая задержка для корректной анимации
            }
        }

        function closeModal() {
            if (modal) {
                modal.classList.remove('open'); // Запустить анимацию исчезновения
                document.body.style.overflow = ''; // Восстановить скролл основной страницы

                // Ждем завершения CSS-анимации перед тем, как скрыть элемент через display:none
                const onTransitionEnd = (event) => {
                    // Убедимся, что событие transitionend пришло от самого modal-overlay
                    if (event.target === modal) {
                        modal.style.display = 'none';
                        modal.removeEventListener('transitionend', onTransitionEnd); // Удаляем слушатель, чтобы он не сработал повторно
                    }
                };
                modal.addEventListener('transitionend', onTransitionEnd);

                // Fallback на случай, если событие transitionend не сработает (например, если transition-duration: 0s)
                // или если анимация была прервана.
                setTimeout(() => {
                    if (modal.style.display === 'flex' && !modal.classList.contains('open')) {
                         modal.style.display = 'none';
                         if (document.body.style.overflow === 'hidden') { // Доп. проверка для скролла
                            document.body.style.overflow = '';
                         }
                    }
                }, 400); // Это значение должно быть немного больше, чем длительность анимации в CSS (0.3s для opacity)
            }
        }

        if (openModalBtn) {
            openModalBtn.addEventListener('click', openModal);
        } else {
            console.warn('Кнопка для открытия модального окна (ID: openNeumorphicModalBtn) не найдена.');
        }

        closeButtons.forEach(button => {
            button.addEventListener('click', closeModal);
        });

        if (modal) {
            // Закрытие по клику на оверлей (мимо содержимого модального окна)
            modal.addEventListener('click', function (event) {
                if (event.target === modal) { 
                    closeModal();
                }
            });
        } else {
            console.warn('Модальное окно (ID: neumorphicModal) не найдено.');
        }

        // Закрытие по нажатию клавиши Escape
        document.addEventListener('keydown', function (event) {
            if (event.key === "Escape" && modal && modal.classList.contains('open')) {
                closeModal();
            }
        });

        if (modalOkButton) {
            modalOkButton.addEventListener('click', function () {
                alert('Нажата кнопка "ОК" в модальном окне! Благодарность принята.');
                closeModal(); // Закрываем модальное окно после действия
            });
        }
    });
</script>
{% endblock scripts_block %}